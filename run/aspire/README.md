# Running winget.pro via Aspire

## Requirements
- [.NET 9.0 SDK](https://dotnet.microsoft.com/download/dotnet/9.0)
- [.NET Aspire SDK](https://learn.microsoft.com/en-us/dotnet/aspire/fundamentals/setup-tooling?tabs=linux&pivots=dotnet-cli)
- Container runtime (Docker, Podman, etc.) Docker is the default see [here](https://learn.microsoft.com/en-us/dotnet/aspire/fundamentals/setup-tooling?tabs=linux&pivots=dotnet-cli#container-runtime)

## Running

Before running You need to trust the ASP.NET Core localhost certificate before running the app. Run the following command:

```dotnetcli
    dotnet dev-certs https --trust
```

To run winget.pro with aspire, first uncomment the `DJANGO_SUPERUSER_...` lines
in [`program.cs`](./WingetPro.Aspire/WingetPro.Aspire.AppHost/Program.cs) and edit them to set the credentials of the user you want to log in with.

Then execute the command below.

```dotnetcli
    dotnet run --project WingetPro.Aspire/WingetPro.Aspire.AppHost
```

You should now be able to open the aspire dashboard and navigate to the nginx proxy to see the winget.pro dashboard.

Before you run `dotnet run --project WingetPro.Aspire/WingetPro.Aspire.AppHost` again, remove the `DJANGO_SUPERUSER_...` lines from [`program.cs`](./WingetPro.Aspire/WingetPro.Aspire.AppHost/Program.cs). Otherwise, the server would attempt to create the initial user again.

`winget` requires repositories to run under `https://`. For production use, you
need to configure the ssl certificate generated by aspire. You can do this by configuring the `nginx` proxy in the [`program.cs`](./WingetPro.Aspire/WingetPro.Aspire.AppHost/Program.cs) file.

**Example Configuration**

```csharp
nginx
    .WithBuildArg("CERTIFICATE_NAME", "name")
    .WithBuildArg("CERTIFICATE_PASSWORD", "password")
    .WithBuildArg("CERTIFICATE_SUBJECT", "subject")
    .WithBuildArg("CERTIFICATE_DNS_NAME", "dnsName")
    .WithBuildArg("CERTIFICATE_EMAIL", "valid email"); //this must be a valid email address
```


 If you are running the aspire project on a private VPS you will need to configure the aspire project to use the production environment. You can do this by setting the `ASPNETCORE_ENVIRONMENT` environment variable to `Production` in the [`launchSettings.json`](./WingetPro.Aspire/WingetPro.Aspire.AppHost/Properties/launchSettings.json) file.

```json
    {
  "$schema": "https://json.schemastore.org/launchsettings.json",
  "profiles": {
    "https": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      "applicationUrl": "https://localhost:17124;http://localhost:15291",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development",
        "DOTNET_ENVIRONMENT": "Development",
        "DOTNET_DASHBOARD_OTLP_ENDPOINT_URL": "https://localhost:21298",
        "DOTNET_RESOURCE_SERVICE_ENDPOINT_URL": "https://localhost:22218"
      }
    },
    "http": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      "applicationUrl": "http://localhost:15291",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development",
        "DOTNET_ENVIRONMENT": "Development",
        "DOTNET_DASHBOARD_OTLP_ENDPOINT_URL": "http://localhost:19030",
        "DOTNET_RESOURCE_SERVICE_ENDPOINT_URL": "http://localhost:20235"
      }
    }
  }
}

```
